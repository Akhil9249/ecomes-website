<%- include('../partials/user-header') %>


<main class="main">
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
        <div class="container"></div>
        <!-- End .container -->
    </nav>
    <!-- End .breadcrumb-nav -->

    <div class="page-content">
        <div class="container">
            <div class="row">
                <div class="col-lg-9 col-xl-4-5col">
                    <div class="mb-3"></div>
                    <!-- End .mb-3 -->

                    <div class="mb-3 mb-lg-5"></div>
                    <!-- End .mb-3 mb-lg-5 -->

                    <div class="cat-blocks-container">
                        <div class="row">
                            <div class="col-6 col-md-3 col-lg-3">
                                <a href="category.html" class="cat-block">
                                    <figure>
                                        <span>
                                            <img src="<%= products[13].image[0] %>" alt="img" class="product-image" style="width: 100px;height: 100px;" />
                                        </span>
                                    </figure>

                                    <h3 class="cat-block-title"><%= products[1].name %></h3>
                                    <!-- End .cat-block-title -->
                                </a>
                            </div>

                            <div class="col-6 col-md-3 col-lg-3">
                                <a href="category.html" class="cat-block">
                                    <figure>
                                        <span>
                                            <img src="<%= products[7].image[0] %>" alt="img" class="product-image" style="width: 100px;height: 100px;" />
                                        </span>
                                    </figure>

                                    <h3 class="cat-block-title"><%= products[7].name %></h3>
                                    <!-- End .cat-block-title -->
                                </a>
                            </div>

                            <div class="col-6 col-md-3 col-lg-3">
                                <a href="category.html" class="cat-block">
                                    <figure>
                                        <span>
                                            <img src="<%= products[1].image[0] %>" alt="img" class="product-image" style="width: 100px;height: 100px;" />
                                        </span>
                                    </figure>

                                    <h3 class="cat-block-title"><%= products[14].name %></h3>
                                    <!-- End .cat-block-title -->
                                </a>
                            </div>

                            <div class="col-6 col-md-3 col-lg-3">
                                <a href="category.html" class="cat-block">
                                    <figure>
                                        <span>
                                            <img src="<%= products[14].image[0] %>" alt="img" class="product-image" style="width: 100px;height: 100px;" />
                                        </span>
                                    </figure>

                                    <h3 class="cat-block-title"><%= products[14].name %></h3>
                                    <!-- End .cat-block-title -->
                                </a>
                            </div>
                            
                            <!-- End .col-6 col-md-4 col-lg-3 -->
                        </div>
                        <!-- End .row -->
                    </div>
                    <!-- End .cat-blocks-container -->

                    <div class="mb-2"></div>
                    <!-- End .mb-2 -->

                    <h2 class="title title-border">Featured Items</h2>
                    <!-- End .title -->

                    <div
                        class="owl-carousel owl-simple owl-nav-top carousel-equal-height carousel-with-shadow"
                        data-toggle="owl"
                        data-owl-options='{
                                    "nav": true, 
                                    "dots": false,
                                    "margin": 20,
                                    "loop": false,
                                    "responsive": {
                                        "0": {
                                            "items":2
                                        },
                                        "480": {
                                            "items":2
                                        },
                                        "768": {
                                            "items":3
                                        },
                                        "1200": {
                                            "items":4
                                        }
                                    }
                                }'
                    >
                        <!-- first code ............ -->
                    </div>
                    <!-- End .owl-carousel -->

                    <div class="mb-4"></div>
                    <!-- End .mb-4 -->

                    <div class="toolbox">
                        <div class="toolbox-left">
                            <div class="toolbox-info">10 Products found</div>
                            <!-- End .toolbox-info -->
                        </div>
                        <!-- End .toolbox-left -->

                        <div class="toolbox-right">
                            <div class="toolbox-sort">
                                <label for="sortby">Sort by:</label>
                                <div class="select-custom">
                                    <select name="sortby" id="sortby" class="form-control">
                                        <option value="popularity" selected="selected">Most Popular</option>
                                        <option value="rating">Most Rated</option>
                                        <option value="date">Date</option>
                                    </select>
                                </div>
                            </div>
                            <!-- End .toolbox-sort -->
                        </div>
                        <!-- End .toolbox-right -->
                    </div>
                    <!-- End .toolbox -->

                    <div class="products mb-3">
                        <div class="row" id="sample">
                            <% for(var i=0;i<8;i++){%>
                                <div class="col-6 col-md-4 col-xl-3" >
                                    <div class="product">
                                        <figure class="product-media">
                                            <span class="product-label label-new">New</span>
                                            
                                            <a href="/single-product?id=<%= products[i]._id%>">
                                                <% if(products[i].image) { %>
                                                <img src="<%= products[i].image[0] %>" alt="img" class="product-image" />
                                                <% }else{ %> Image Not Found <% } %>
                                            </a>

                                            <div class="product-action-vertical">
                                                <form onsubmit="return false">
                                                    <button class="btn-product-icon btn-wishlist btn-expandable" onclick="addtowishlist('<%= products[i]._id %>','<%= products[i].price %>')" type="submit"><span>add to wishlist</span></button>
                                                </form>                                            </div><!-- End .product-action-vertical -->

                                            <div class="product-action">
                                                <form onsubmit="return false">
                                                    <button class="btn-product btn-cart" title="Add to cart" onclick="addtocart('<%= products[i]._id %>','<%= products[i].price %>')" type="submit"><span>add to cart</span></button>
                                                </form>
                                            </div><!-- End .product-action -->
                                        </figure><!-- End .product-media -->

                                        <div class="product-body">
                                            <div class="product-cat">
                                                <!-- <a href="#">Appliances</a> -->
                                            </div><!-- End .product-cat -->
                                            <h3 class="product-title"><a href="product.html"><%= products[i].name %></a></h3><!-- End .product-title -->
                                            <div class="product-price">
                                                $<%= products[i].price %>
                                            </div><!-- End .product-price -->
                                            <div class="ratings-container">
                                                <div class="ratings">
                                                    <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                                                </div><!-- End .ratings -->
                                                <span class="ratings-text">( 12 Reviews )</span>
                                            </div><!-- End .rating-container -->
                                        </div><!-- End .product-body -->
                                    </div><!-- End .product -->
                                </div><!-- End .col-sm-6 col-md-4 col-xl-3 -->
                                
                                <%}%>
                        </div>
                        <!-- End .row -->
                    </div>
                    <!-- End .products -->

                    <div class="toolbox">
                        <div class="toolbox-left">
                            <div class="toolbox-info">10 Products found</div>
                            <!-- End .toolbox-info -->
                        </div>
                        <!-- End .toolbox-left -->

                        <div class="toolbox-right">
                            <div class="toolbox-sort">
                                <label for="sortby">Sort by:</label>
                                <div class="select-custom">
                                    <select name="sortby" id="sortby" class="form-control">
                                        <option value="popularity" selected="selected">Most Popular</option>
                                        <option value="rating">Most Rated</option>
                                        <option value="date">Date</option>
                                    </select>
                                </div>
                            </div>
                            <!-- End .toolbox-sort -->
                        </div>
                        <!-- End .toolbox-right -->
                    </div>
                    <!-- End .toolbox -->

                    <div class="products mb-3">
                        <!-- Third code ............. -->
                    </div>
                    <!-- End .products -->

                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <li class="page-item disabled">
                                <a
                                    class="page-link page-link-prev"
                                    href="#"
                                    aria-label="Previous"
                                    tabindex="-1"
                                    aria-disabled="true"
                                >
                                    <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span>Prev
                                </a>
                            </li>
                            <li class="page-item active" aria-current="page"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item-total">of 2</li>
                            <li class="page-item">
                                <a class="page-link page-link-next" href="#" aria-label="Next">
                                     <span aria-hidden="true" onclick="page(8,'<%= products.length%>')">Next<i class="icon-long-arrow-right"></i></span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- End .col-lg-9 -->

                <aside class="col-lg-3 col-xl-5col order-lg-first">
                    <div class="sidebar sidebar-shop">
                        <div class="widget">
                            <h3 class="widget-title">Categories</h3>
                            <!-- End .widget-title -->

                            <div class="widget-body">
                                <div class="filter-items">
                                    <div class="filter-item">
                                        <div class="custom-control custom-checkbox">
                                            <input
                                                type="checkbox"
                                                onclick="getCategory('Headphone')"
                                                class="custom-control-input"
                                                id="brand-1"
                                            />
                                            <label class="custom-control-label" for="brand-1">headphones</label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->

                                    <div class="filter-item">
                                        <div class="custom-control custom-checkbox">
                                            <input
                                                type="checkbox"
                                                onclick="getCategory('Speaker')"
                                                class="custom-control-input"
                                                id="brand-6"
                                            />
                                            <label class="custom-control-label" for="brand-6">watch</label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->

                                    <div class="filter-item">
                                        <div class="custom-control custom-checkbox">
                                            <input
                                                type="checkbox"
                                                onclick="getCategory('Speaker')"
                                                class="custom-control-input"
                                                id="brand-7"
                                            />
                                            <label class="custom-control-label" for="brand-7">speaker</label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->
                                </div>
                                <!-- End .filter-items -->
                            </div>
                            <!-- End .widget-body -->
                        </div>
                        <!-- End .widget -->

                        <div class="widget">
                            <h3 class="widget-title">Price</h3>
                            <!-- End .widget-title -->

                            <div class="widget-body">
                                <div class="filter-items">
                                    <div class="filter-item">
                                        <div class="custom-control custom-radio">
                                            <input
                                                type="radio"
                                                class="custom-control-input"
                                                id="price-1"
                                                name="filter-price"
                                                onclick="priceSort(1)"
                                            />
                                            <label class="custom-control-label" for="price-1">Low to High</label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->
                                    <br />

                                    <div class="filter-item">
                                        <div class="custom-control custom-radio">
                                            <input
                                                type="radio"
                                                class="custom-control-input"
                                                id="price-2"
                                                name="filter-price"
                                                onclick="priceSort(-1)"
                                            />
                                            <label class="custom-control-label" for="price-2">High to Low </label>
                                        </div>
                                        <!-- End .custom-checkbox -->
                                    </div>
                                    <!-- End .filter-item -->
                                </div>
                                <!-- End .filter-items -->
                            </div>
                            <!-- End .widget-body -->
                        </div>
                        <!-- End .widget -->
                    </div>
                    <!-- End .sidebar sidebar-shop -->
                </aside>
                <!-- End .col-lg-3 -->
            </div>
            <!-- End .row -->
        </div>
        <!-- End .container -->
    </div>
    <!-- End .page-content -->
</main>
<!-- End .main -->

<script>
    let categorycheckbox = new Array();
    let productvalue = null;
    let result=0
    // let prlength=0

    function addtocart(i,p) {
              let productid = document.getElementById("productid")
              let productprice = document.getElementById("productprice")

              let valid = i
              let pric = p

                console.log("haiii")
                console.log(valid+"valid")
                console.log(pric+"price")
            fetch('/addcart', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: valid,price:pric }) // Replace this with your data
            })
            .then(response => {
                // Handle the response as needed
                console.log('PUT request sent');
            })
            .catch(error => {
                // Handle any errors
                console.error('Error sending PUT request:', error);
            });
        }


        function addtowishlist(i,p) {
              let productid = document.getElementById("productid")
              let productprice = document.getElementById("productprice")

              let valid = i
              let pric = p

                console.log("haiii")
                console.log(valid+"valid")
                console.log(pric+"price")
            fetch('/addwishlist', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: valid,price:pric }) // Replace this with your data
            })
            .then(response => {
                // Handle the response as needed
                console.log('PUT request sent');
            })
            .catch(error => {
                // Handle any errors
                console.error('Error sending PUT request:', error);
            });
        }


    //*********************** search ***********************//

    function productsearch(){        
        
        const value = document.getElementById("searchValue").value

        fetch("/poduct/search", {
                method: "post",
                headers: {
                    "Content-Type": "application/json",
                    // Add any other headers here if needed
                },
                body: JSON.stringify({ va: value }),
            })
                .then((response) => {
                    console.log("5....");
                    const result = response.json();
                    // console.log(result);
                    return result;
                })
                .then((data) => {
                    console.log("data==" + data);

                    resultcall(data);
                })
                .catch((err) => console.log(err));


        console.log(value)
    }


    //*********************** pagination ***********************//

    function page(value,len){  

        console.log(len)
        
        result=result+value
        console.log(result)

        
        

        console.log("first")
        // const value = document.getElementById("searchValue").value

        fetch("/poduct/pagin", {
                method: "post",
                headers: {
                    "Content-Type": "application/json",
                    // Add any other headers here if needed
                },
                body: JSON.stringify({ svalue: result,lvalue: value }),
            })
                .then((response) => {
                    console.log("5....");
                    const result = response.json();
                    // console.log(result);
                    return result;
                })
                .then((data) => {
                    console.log("data==" + data);
                    resultcall(data)
                    
                })
                .catch((err) => console.log(err));


        console.log(value)
    }


    //*********************** Sort ***********************//

    function priceSort(val) {
        let value = val;
        if (value == 1) {
            // console.log("2....")
            fetch("/poduct/sortfind", {
                method: "post",
                headers: {
                    "Content-Type": "application/json",
                    // Add any other headers here if needed
                },
                body: JSON.stringify({ va: value }),
            })
                .then((response) => {
                    console.log("5....");
                    const result = response.json();
                    // console.log(result);
                    return result;
                })
                .then((data) => {
                    console.log("data==" + data);

                    resultcall(data);
                })
                .catch((err) => console.log(err));
        } else if (value == -1) {
            // console.log("2....")
            fetch("/poduct/sortfind", {
                method: "post",
                headers: {
                    "Content-Type": "application/json",
                    // Add any other headers here if needed
                },
                body: JSON.stringify({ va: value }),
            })
                .then((response) => {
                    console.log("5....");
                    const result = response.json();
                    // console.log(result);
                    return result;
                })
                .then((data) => {
                    console.log("data==" + data);

                    resultcall(data);
                })
                .catch((err) => console.log(err));
        }
    }

    //*********************** Category ***********************//

    function getCategory(name) {
        const category = name;

        if (categorycheckbox.includes(name)) {
            const index = categorycheckbox.indexOf(name);
            console.log(index);
            categorycheckbox.splice(index, 1);
            console.log("slice");
        } else {
            categorycheckbox.push(name);
            console.log("push");
        }

        console.log(categorycheckbox);

        if (categorycheckbox.length > 0) {
            fetch("/poduct/filter", {
                method: "post",
                headers: {
                    "Content-Type": "application/json",
                    // Add any other headers here if needed
                },
                body: JSON.stringify(categorycheckbox),
            })
                .then((response) => {
                    const result = response.json();
                    console.log(result);
                    // productvalue = result;
                    return result;
                })
                .then((data) => {
                    console.log("data==" + data);
                    resultcall(data);
                });
        }
    }

    //*********************** Resultcall ***********************//

    function resultcall(data) {
        let productdiv = document.getElementById("sample");

        productdiv.innerHTML = "";

        data.forEach((element) => {
            console.log(element.name);
            const item = ` 
        <div class="col-6 col-md-4 col-xl-3">
                                    <div class="product">
                                        <figure class="product-media">
                                    <span class="product-label label-new">New</span>

                                    <a href="/single-product?id=${element._id}">
                                        <img src="${element.image}" alt="img" class="product-image" />
                                      
                                    </a>

                                    <div class="product-action-vertical">
                                        <a href="#" class="btn-product-icon btn-wishlist btn-expandable"><span>add to wishlist</span></a>
                                    </div><!-- End .product-action-vertical -->

                                    <div class="product-action">
                                        <a href="#" class="btn-product btn-cart" title="Add to cart"><span>add to cart</span></a>
                                    </div><!-- End .product-action -->
                                </figure><!-- End .product-media -->

                                <div class="product-body">
                                    <div class="product-cat">
                                        <!-- <a href="#">Appliances</a> -->
                                    </div><!-- End .product-cat -->
                                    <h3 class="product-title"><a href="product.html">${element.name}</a></h3><!-- End .product-title -->
                                    <div class="product-price">
                                        ${element.price}
                                    </div><!-- End .product-price -->
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                        <span class="ratings-text">( 12 Reviews )</span>
                                    </div><!-- End .rating-container -->
                                </div><!-- End .product-body -->
                                    </div><!-- End .product -->
                                </div><!-- End .col-sm-6 col-md-4 col-xl-3 -->
        `;
            productdiv.innerHTML += item;
        });
    }
</script>

<%- include('../partials/user-footer') %>
